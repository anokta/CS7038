using UnityEngine;
using System.Collections;
using System.Collections.Generic;
using Grouping;
using Prime31;

public class TwitterIntegration : SocialIntegration {

	#if UNITY_IPHONE || UNITY_ANDROID

	private string status, url;
    
    protected override void Start () {
		TwitterCombo.init( "TNyjAhkYkSgby6khane9jle6d", "sHvkl2q8y3XJ8ZEuYeJnvxsBYvXzgqoebnzOLxw4xluVF649QW" );

        base.Start();
	}

    protected override void OnEnable()
	{
		TwitterManager.loginSucceededEvent += LoginSucceeded;
		TwitterManager.loginFailedEvent += LoginFailed;
		TwitterManager.requestDidFinishEvent += PostTweetSucceeded;
		TwitterManager.requestDidFailEvent += PostTweetFailed;

        base.OnEnable();
	}

	void OnDisable()
	{
		TwitterManager.loginSucceededEvent -= LoginSucceeded;
		TwitterManager.loginFailedEvent -= LoginFailed;
		TwitterManager.requestDidFinishEvent -= PostTweetSucceeded;
		TwitterManager.requestDidFailEvent -= PostTweetFailed;
	}

	void LoginSucceeded(object result)
	{
		TwitterCombo.postStatusUpdate (status + " " + url);
	}

	void LoginFailed(string error)
	{
		popupMessage = "Login to Twitter failed.";
		popupActive = true;
	}

	void PostTweetSucceeded(object result)
	{
		if (TwitterCombo.isLoggedIn ()) {
			popupMessage = "Tweet is posted!";
			popupActive = true;
		}
	}

	void PostTweetFailed(string error)
	{		
		popupMessage = "Tweet could not be posted.";
		popupActive = true;
	}

<<<<<<< HEAD
	void OnGUI()
	{
		if (popupActive || popupY < 1.0f) {
			if (Input.GetMouseButtonDown (0)) {
				popupActive = false;		
			}

			popupY = Mathf.Lerp (popupY, popupActive ? 0.9f : 1.1f, Time.deltaTime * 4);

			GUI.Window(5, new Rect(Screen.width * 0.5f - Screen.height * 0.15f, Screen.height * popupY, Screen.height * 0.3f, Screen.height * 0.1f), DoPopup, "", GUIManager.Style.inGameWindow);
		}
	}

	void DoPopup(int id)
	{
		GUILayout.FlexibleSpace ();
		GUILayout.BeginHorizontal ();
		GUILayout.FlexibleSpace ();
		GUILayout.Label (popupMessage, GUIManager.Style.log);
		GUILayout.FlexibleSpace ();
		GUILayout.EndHorizontal ();
		GUILayout.FlexibleSpace ();
	}

	public void Post(string status, string url)
=======
    public override void Post(string status, string url)
>>>>>>> 744b24af2a6721d46d3aadf7571ca1c280f381b3
	{
		this.status = status;
		this.url = url;

		TwitterCombo.showLoginDialog();		
	}

#endif

                                                    }
